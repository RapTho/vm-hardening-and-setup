---
- name: Gather facts about the system
  setup:
    gather_subset:
      - "!all"
      - "!min"
      - "distribution"

- name: Check if system is RHEL or derivative
  set_fact:
    is_rhel_derivative: "{{ ansible_facts['distribution'] in ['RedHat', 'CentOS', 'Rocky', 'AlmaLinux', 'Fedora'] }}"

- name: Fail if not running on RHEL or derivative
  fail:
    msg: "This role is designed for RHEL and its derivatives. Current OS: {{ ansible_facts['distribution'] }}"
  when: not is_rhel_derivative

- name: Detect the hosts ssh port
  import_tasks: detect_ssh_port.yml

- name: Security hardening of the host
  import_tasks: security.yml
